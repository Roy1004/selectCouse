<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <link rel="shortcut icon" href="images/logo.png" type="image/png">
    <title>查看已开课程</title>
    <link href="css/style.default.css" rel="stylesheet">
    <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="css/childStyle.css">
    <link rel="stylesheet" href="css/bootstrap-table.min.css">
    <style type="text/css">
        .list-group{margin-bottom: 0;}
        .list-group-item{padding:5px 15px;}
        .modal-header,.modal-footer{padding: 5px;}
    </style>
</head>
<body>
    <div class="container-fluid child-page">
        <div class="panel panel-default user-info">
            <div class="panel-heading">
                <div class="row">
                    <div class="right col-md-3">
                        <input type="text" name="cid" id="cid" class="input-sm col-md-6" placeholder="课程号" autocomplete="off">
                        <button class="btn btn-primary" id="search1"><span class="glyphicon glyphicon-search style"></span>搜索</button>
                    </div>
                    <div class="right col-md-3">
                        <input type="text" name="cname" id="cname" class="col-md-6 input-sm" placeholder="课程名" autocomplete="off">
                        <button class="btn btn-primary" id="search2"><span class="glyphicon glyphicon-search style"></span>搜索</button>
                    </div>
                </div>
            </div>
            <div class="panel-body panel-body-nopadding">
                <div id="toolbar">
                    <div class="row">
                        <div class="right col-md-12">
                            <button class="btn btn-primary btn-sm" data-toggle="modal" data-target="#modal1" data-backdrop="static" id="add"><span class="glyphicon glyphicon-plus style"></span>添加</button>
                            <button class="btn btn-info btn-sm" data-toggle="modal" data-target="#modal2" data-backdrop="static" id="change"><span class="glyphicon glyphicon-pencil style"></span>修改</button>
                            <button class="btn btn-warning btn-sm"><span class="glyphicon glyphicon-trash style" id="del"></span>删除</button>
                        </div>
                    </div>
                </div>
                <table class="table table-hover table-condensed" id="table1"></table>
            </div>
        </div>
        <div class="modal fade" id="modal1" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title" id="Modal1Label">添加课程信息：</h4>
                    </div>
                    <div class="modal-body">
                        <form class="form-horizontal form-bordered form-inline" role="form" id="addInfo">
                            <ul class="list-group">
                                <li class="list-group-item"><label class="col-md-3">课程号</label><input type="text" name="cid" id="cid1"></li>
                                <li class="list-group-item"><label class="col-md-3">课程名</label><input type="text" name="cname" id="cname1"></li>
                                <li class="list-group-item"><label class="col-md-3">总容量</label><input type="text" name="total" id="total1"></li>
                                <li class="list-group-item">
                                    <ul class="list-group">
                                        <li class="list-group-item" style="display: inline;">
                                            <label>开课时间</label>
                                            第<select class="form-control" name="start" id="start1">
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                                <option value="5">5</option>
                                                <option value="6">6</option>
                                                <option value="7">7</option>
                                                <option value="8">8</option>
                                                <option value="9">9</option>
                                                <option value="10">10</option>
                                                <option value="11">11</option>
                                                <option value="12">12</option>
                                                <option value="13">13</option>
                                                <option value="14">14</option>
                                                <option value="15">15</option>
                                                <option value="16">16</option>
                                                <option value="17">17</option>
                                                <option value="18">18</option>
                                            </select>周
                                        </li>
                                        <li class="list-group-item" style="display: inline;">
                                            <label>结课时间</label>
                                            第<select class="form-control" name="end" id="end1">
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                                <option value="5">5</option>
                                                <option value="6">6</option>
                                                <option value="7">7</option>
                                                <option value="8">8</option>
                                                <option value="9">9</option>
                                                <option value="10">10</option>
                                                <option value="11">11</option>
                                                <option value="12">12</option>
                                                <option value="13">13</option>
                                                <option value="14">14</option>
                                                <option value="15">15</option>
                                                <option value="16">16</option>
                                                <option value="17">17</option>
                                                <option value="18">18</option>
                                            </select>周
                                        </li>
                                    </ul>
                                 </li>
                                <li class="list-group-item">
                                    <ul class="list-group">
                                        <li class="list-group-item" style="display: inline;">
                                            <label>学年</label>
                                            <select class="form-control" name="year" id="year1">
                                            <option value="1">2013-2014</option>
                                            <option value="2">2014-2015</option>
                                            <option value="3">2015-2016</option>
                                            <option value="4">2016-2017</option>
                                            </select>
                                        </li>
                                        <li class="list-group-item" style="display: inline;">
                                            <label>学年</label>
                                            <select class="form-control" name="semester" id="semester1">
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                        </select>
                                        </li>
                                    </ul>
                                </li>
                                <li class="list-group-item"><label class="col-md-3">上课地点</label><input type="text" name="place" id="place1"></li>
                                <li class="list-group-item">
                                    <label class="col-md-3">性别限制</label>
                                    <select class="form-control" name="xbxz" id="xbxz1">
                                        <option value="1">无</option>
                                        <option value="2">男</option>
                                        <option value="3">女</option>
                                    </select>
                                </li>
                                <li class="list-group-item">
                                    <label class="col-md-3">教师</label>
                                    <input type="text" name="tname" id="tname1">
                                </li>
                            </ul>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="save1">保存</button>
                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="modal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title" id="Modal1Labe2">修改课程信息：</h4>
                    </div>
                    <div class="modal-body">
                        <form class="form-horizontal form-bordered form-inline" role="form" id="updateInfo">
                            <ul class="list-group">
                                <li class="list-group-item"><label class="col-md-3">课程号</label><input type="text" name="cid" id="cid2"></li>
                                <li class="list-group-item"><label class="col-md-3">课程名</label><input type="text" name="cname" id="cname2"></li>
                                <li class="list-group-item"><label class="col-md-3">总容量</label><input type="text" name="total" id="total2"></li>
                                <li class="list-group-item">
                                    <ul class="list-group">
                                        <li class="list-group-item" style="display: inline;">
                                            <label>开课时间</label>
                                            第<select class="form-control" name="start" id="start2">
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                            <option value="5">5</option>
                                            <option value="6">6</option>
                                            <option value="7">7</option>
                                            <option value="8">8</option>
                                            <option value="9">9</option>
                                            <option value="10">10</option>
                                            <option value="11">11</option>
                                            <option value="12">12</option>
                                            <option value="13">13</option>
                                            <option value="14">14</option>
                                            <option value="15">15</option>
                                            <option value="16">16</option>
                                            <option value="17">17</option>
                                            <option value="18">18</option>
                                        </select>周
                                        </li>
                                        <li class="list-group-item" style="display: inline;">
                                            <label>结课时间</label>
                                            第<select class="form-control" name="end" id="end2">
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                            <option value="5">5</option>
                                            <option value="6">6</option>
                                            <option value="7">7</option>
                                            <option value="8">8</option>
                                            <option value="9">9</option>
                                            <option value="10">10</option>
                                            <option value="11">11</option>
                                            <option value="12">12</option>
                                            <option value="13">13</option>
                                            <option value="14">14</option>
                                            <option value="15">15</option>
                                            <option value="16">16</option>
                                            <option value="17">17</option>
                                            <option value="18">18</option>
                                        </select>周
                                        </li>
                                    </ul>
                                </li>
                                <li class="list-group-item">
                                    <ul class="list-group">
                                        <li class="list-group-item" style="display: inline;">
                                            <label>学年</label>
                                            <select class="form-control" name="year" id="year2">
                                                <option value="1">2013-2014</option>
                                                <option value="2">2014-2015</option>
                                                <option value="3">2015-2016</option>
                                                <option value="4">2016-2017</option>
                                            </select>
                                        </li>
                                        <li class="list-group-item" style="display: inline;">
                                            <label>学年</label>
                                            <select class="form-control" name="semester" id="semester2">
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                            </select>
                                        </li>
                                    </ul>
                                </li>
                                <li class="list-group-item"><label class="col-md-3">上课地点</label><input type="text" name="place" id="place2"></li>
                                <li class="list-group-item">
                                    <label class="col-md-3">性别限制</label>
                                    <select class="form-control" name="xbxz" id="xbxz2">
                                        <option value="1">无</option>
                                        <option value="2">男</option>
                                        <option value="3">女</option>
                                    </select>
                                </li>
                                <li class="list-group-item">
                                    <label class="col-md-3">教师</label>
                                    <input type="text" name="tname" id="tname2">
                                </li>
                            </ul>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="save2">保存</button>
                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="js/jquery-1.11.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/bootstrap-table.min.js"></script>
    <script src="js/bootstrap-table-zh-CN.min.js"></script>
    <script src="js/bootstrap-table-export.js"></script>
    <script src="js/tableExport.js"></script>
    <script src="js/jquery.serializejson.js"></script>
    <script src="js/jquery.formautofill.min.js"></script>
    <script src="js/public.js"></script>
    <script type="text/javascript">
        $(function () {
            //1.初始化Table
            var oTable = new TableInit();
            oTable.Init();

            //2.初始化Button的点击事件
            /* var oButtonInit = new ButtonInit();
             oButtonInit.Init(); */
        });
        $("#search1").click(function () {
            if($('#cid').val()==""){
                alert("请输入查询条件!");
            }else{
                $('#table1').bootstrapTable('refresh');
            }
        });
        $("#search2").click(function () {
            if($('#cname').val()==""){
                alert("请输入查询条件!");
            }else{
                $('#table1').bootstrapTable('refresh');
            }
        });
        var TableInit = function () {
            var oTableInit = new Object();
            //初始化Table
            oTableInit.Init = function () {
                $('#table1').bootstrapTable({
                    url: "",
                    method: 'post',
                    cache: false,//禁止缓存
                    dataType: "json",
                    toolbar: '#toolbar', // 工具按钮用哪个容器
                    striped: false,//禁止条纹显示
                    clickToSelect: true, //点击行就选中
                    showColumns: true,  //显示隐藏列
                    minimumCountColumns: 2,          //最少允许的列数
                    showRefresh: true,  //显示刷新按钮
                   /* singleSelect: false, //复选框只能选择一条记录*!*/
                    pagination: true, //分页
                    sidePagination: "server", //服务端处理分页
                    showPaginationSwitch: false,//是否显示分页数
                    pageNumber: 1,   //初始化加载第一页，默认第一页
                    pageSize: 10,   //每页的记录行数（*）
                    pageList: [10, 20], //可供选择的每页的行数（*）
                    locale: 'zh-CN', //国际化
                    queryParams: oTableInit.queryParams,//传递参数（*）
                    queryParamsType: 'limit', //类型
//        search:true,
                   showToggle : true,// 是否显示详细视图和列表视图的切换按钮
                   cardView :false, // 是否显示详细视图
                    showExport: true,                     //是否显示导出
                    exportDataType: "basic", //basic'导出当前页, 'all'导出全部, 'selected'导出选中项.
                    columns: [
                    {
                        field:'',
                        title:'',
                        checkbox: true
                    }, //复选框
                    {
                    title: '课程号',
                        field: 'cid',
                        align: 'center',
                    valign: 'middle'
                    },
                    {
                        title: '课程名称',
                        field: 'cname',
                        align: 'center',
                    valign: 'middle'
                    },
                    {
                        title: '总容量',
                        field: 'total',
                        align: 'center'
                    },
                    {
                        title: '开课时间',
                        field: 'start',
                        align: 'center'
                    },
                    {
                        title: '结课时间',
                        field: 'end',
                        align: 'center'
                    },
                    {
                        title: '上课地点',
                        field: 'place',
                        align: 'center'
                    },
                    {
                        title: '性别限制',
                        field: 'xbxz',
                        align: 'center'
                    },
                    {
                        title: '年级限制',
                        field: 'njxz',
                        align: 'center'
                    }
                    ]
                    });
                    };
                        //得到查询的参数
                        oTableInit.queryParams = function (params) {
                            var temp = { //这里的键的名字和控制器的变量名必须一直，这边改动，控制器也需要改成一样的
                                limit: params.limit, //页面大小
                                offset: params.offset, //页码
                                cid: $("#cid").val(),
                                cname: $("#cname").val(),
                                maxrows: params.limit,
                                pageindex:params.pageNumber
                            };
                            return temp;
                        };
                        return oTableInit;
             };
        //删除课程信息
        $("#del").click(function () {
            var rows= $('#table1').bootstrapTable('getSelections');
            if (rows.length==0){
                alert("请选择你要删除的学生!");
                return;
            }
            var r=confirm("您确认要删掉这"+rows.length+"条课程信息吗？");
            if(r){
                for(i=0;i<rows.length;i++){
                    $.ajax({
                            type: 'delete',
                            url:'api/illInfo/'+row[i]['cid']
                        }
                    )
                }
                $('#table1').bootstrapTable('refresh');
            }
        });
        //保存课程信息
        $("#save1").click(function () {
            var cid=$("#cid1").val();
            var cname=$("#cname1").val();
            var total=$("#total1").val();
            var place=$("#place1").val();
            var tname=$("#tname1").val();
            if(cid=="" || cname=="" || total=="" || place=="" || bj=="" || tname==""){
                alert("信息填写不完整!");
                return;
            }else{
                $.ajax({
                    type:"post",
                    url:"",
                    data:JSON.stringify( $('#addInfo').serializeJSON()),
                    dataType:"json",
                    success:function (result) {
                        if(result.errorMsg){
                            alert(result.errorMsg);
                            return;
                        }else{
                            alert("添加成功！");
                            $("#modal1").hide();
                            $('#table1').bootstrapTable('refresh');
                        }
                    }
                })
            }
        });
        //修改课程信息
        $("#change").click(function () {
            var rows = $('#table1').bootstrapTable('getSelections');
           if(rows.length!=1){
              alert("请选择一个课程!");
                $("#change").attr("data-target","");
                return;
            }else{
                $("#change").attr("data-target","#modal2");
                $.ajax({
                    type:"get",
                    url:''+rows[0]["cid"],
                    datatype:'json',
                    success:function (data) {
                        formAutofll("updateInfo",rows[0]);
                        $("#tname2").val(data[0].tname);
                       //????
                    }
                });
            }
        });
        $("#save2").click(function () {
            var rows = $('#table1').bootstrapTable('getSelections');
            $.ajax({
                type:"post",
                url:"",
                data:JSON.stringify( $('#updateInfo').serializeJSON()),
                dataType:"json",
                success:function (result) {
                    if(result.errorMsg){
                        alert(result.errorMsg);
                        return;
                    }else{
                        alert("修改成功！");
                        $("#modal2").hide();
                        $('#table1').bootstrapTable('refresh');
                    }
                }
            })
        })
    </script>
</body>
</html>